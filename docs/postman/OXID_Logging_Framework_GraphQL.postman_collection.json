{
	"info": {
		"_postman_id": "oxs-logging-framework-graphql",
		"name": "OXID Logging Framework - GraphQL API",
		"description": "GraphQL API Endpoints für das OXID Logging Framework Modul.\n\n## Authentifizierung\n\nDie meisten Endpunkte erfordern eine JWT-Authentifizierung. Verwenden Sie zuerst die OXID GraphQL Base `token`-Query, um ein Token zu erhalten.\n\n## Komponenten\n\n- **ApiUser**: API-Benutzer Setup und Passwort-Verwaltung\n- **RequestLoggerRemote**: Remote-Steuerung des Request Loggers\n- **LogSender**: Abruf von Log-Dateien vom Shop",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost.local/graphql",
			"type": "string",
			"description": "Die GraphQL Endpoint URL Ihres OXID Shops"
		},
		{
			"key": "authToken",
			"value": "",
			"type": "string",
			"description": "JWT Token (wird automatisch beim Login gesetzt)"
		},
		{
			"key": "apiUsername",
			"value": "loggingframework-api@oxid-esales.com",
			"type": "string",
			"description": "API-Benutzer E-Mail (Standard: loggingframework-api@oxid-esales.com)"
		},
		{
			"key": "apiPassword",
			"value": "",
			"type": "string",
			"description": "API-Benutzer Passwort"
		},
		{
			"key": "setupToken",
			"value": "",
			"type": "string",
			"description": "Setup-Token aus dem OXID Admin (wird nach Verwendung invalidiert)"
		},
		{
			"key": "newPassword",
			"value": "",
			"type": "string",
			"description": "Neues Passwort für den API-Benutzer (min. 8 Zeichen)"
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{authToken}}",
				"type": "string"
			}
		]
	},
	"item": [
		{
			"name": "Authentication",
			"description": "OXID GraphQL Base Authentifizierung",
			"item": [
				{
					"name": "Get Token (Login)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.data && jsonData.data.token) {",
									"    pm.collectionVariables.set('authToken', jsonData.data.token);",
									"    console.log('Token saved to collection variable');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query Token($username: String!, $password: String!) {\n    token(username: $username, password: $password)\n}",
								"variables": "{\n    \"username\": \"{{apiUsername}}\",\n    \"password\": \"{{apiPassword}}\"\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Authentifizierung mit dem Logging Framework API-Benutzer. Das Token wird automatisch in der Collection-Variable gespeichert."
					},
					"response": []
				}
			]
		},
		{
			"name": "ApiUser - Password Management",
			"description": "API-Benutzer Passwort-Verwaltung\n\n**Hinweis:** `loggingFrameworkSetPassword` erfordert KEINE Authentifizierung, aber einen gültigen Setup-Token.",
			"item": [
				{
					"name": "Set Password (Token-Auth)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.data && jsonData.data.loggingFrameworkSetPassword === true) {",
									"    // Password was set successfully, copy newPassword to apiPassword",
									"    var newPwd = pm.collectionVariables.get('newPassword');",
									"    pm.collectionVariables.set('apiPassword', newPwd);",
									"    // Clear setupToken since it's now invalid",
									"    pm.collectionVariables.set('setupToken', '');",
									"    console.log('Password set successfully. apiPassword updated, setupToken cleared.');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation SetPassword($token: String!, $password: String!) {\n    loggingFrameworkSetPassword(token: $token, password: $password)\n}",
								"variables": "{\n    \"token\": \"{{setupToken}}\",\n    \"password\": \"{{newPassword}}\"\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Setzt das Passwort für den Logging Framework API-Benutzer.\n\n**Voraussetzungen:**\n- Modul muss aktiviert sein\n- Setup-Token muss existieren (wird im Admin generiert)\n\n**Hinweis:** Der Token wird nach erfolgreicher Verwendung invalidiert. Das neue Passwort wird automatisch in `apiPassword` gespeichert."
					},
					"response": []
				},
				{
					"name": "Reset Password (Admin-Auth)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ResetPassword {\n    loggingFrameworkResetPassword\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Setzt das Passwort des API-Benutzers zurück und generiert einen neuen Setup-Token.\n\n**Erfordert:** `OXSLOGGINGFRAMEWORK_PASSWORD_RESET` Berechtigung (Admin oder API-Benutzergruppe)"
					},
					"response": []
				}
			]
		},
		{
			"name": "RequestLoggerRemote - Activation",
			"description": "Aktivierung/Deaktivierung des Request Loggers",
			"item": [
				{
					"name": "Is Active",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query IsActive {\n    requestLoggerIsActive\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Prüft, ob der Request Logger aktuell aktiv ist.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Activate",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation Activate {\n    requestLoggerActivate\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Aktiviert den Request Logger.\n\n**Erfordert:** `REQUEST_LOGGER_ACTIVATE` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Deactivate",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation Deactivate {\n    requestLoggerDeactivate\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Deaktiviert den Request Logger.\n\n**Erfordert:** `REQUEST_LOGGER_ACTIVATE` Berechtigung"
					},
					"response": []
				}
			]
		},
		{
			"name": "RequestLoggerRemote - Settings (Queries)",
			"description": "Einstellungen abfragen",
			"item": [
				{
					"name": "Get All Settings",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetAllSettings {\n    requestLoggerSettings {\n        name\n        value\n        type\n    }\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt alle Request Logger Einstellungen mit Namen, Wert und Typ zurück.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Get Log Level",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetLogLevel {\n    requestLoggerLogLevel\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt das aktuelle Log-Level zurück (z.B. 'debug', 'info', 'warning', 'error').\n\n**Erfordert:** `REQUEST_LOGGER_VIEW` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Get Log Frontend",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetLogFrontend {\n    requestLoggerLogFrontend\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Prüft, ob Frontend-Requests geloggt werden.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Get Log Admin",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetLogAdmin {\n    requestLoggerLogAdmin\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Prüft, ob Admin-Requests geloggt werden.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Get Redact Items",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetRedactItems {\n    requestLoggerRedact\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt die Liste der zu schwärzenden Felder als JSON-Array zurück.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Get Redact All Values",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetRedactAllValues {\n    requestLoggerRedactAllValues\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Prüft, ob alle Werte geschwärzt werden.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW` Berechtigung"
					},
					"response": []
				}
			]
		},
		{
			"name": "RequestLoggerRemote - Settings (Mutations)",
			"description": "Einstellungen ändern",
			"item": [
				{
					"name": "Change Log Level",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ChangeLogLevel($value: String!) {\n    requestLoggerLogLevelChange(value: $value)\n}",
								"variables": "{\n    \"value\": \"debug\"\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Ändert das Log-Level.\n\n**Gültige Werte:** 'debug', 'info', 'notice', 'warning', 'error', 'critical', 'alert', 'emergency'\n\n**Erfordert:** `REQUEST_LOGGER_CHANGE` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Change Log Frontend",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ChangeLogFrontend($value: Boolean!) {\n    requestLoggerLogFrontendChange(value: $value)\n}",
								"variables": "{\n    \"value\": true\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Aktiviert/Deaktiviert das Logging von Frontend-Requests.\n\n**Erfordert:** `REQUEST_LOGGER_CHANGE` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Change Log Admin",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ChangeLogAdmin($value: Boolean!) {\n    requestLoggerLogAdminChange(value: $value)\n}",
								"variables": "{\n    \"value\": false\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Aktiviert/Deaktiviert das Logging von Admin-Requests.\n\n**Erfordert:** `REQUEST_LOGGER_CHANGE` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Change Redact Items",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ChangeRedactItems($value: String!) {\n    requestLoggerRedactChange(value: $value)\n}",
								"variables": "{\n    \"value\": \"[\\\"password\\\", \\\"creditcard\\\", \\\"cvv\\\"]\"\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Setzt die Liste der zu schwärzenden Felder.\n\n**Format:** JSON-Array als String\n\n**Erfordert:** `REQUEST_LOGGER_CHANGE` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Change Redact All Values",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ChangeRedactAllValues($value: Boolean!) {\n    requestLoggerRedactAllValuesChange(value: $value)\n}",
								"variables": "{\n    \"value\": false\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Aktiviert/Deaktiviert das Schwärzen aller Werte.\n\n**Erfordert:** `REQUEST_LOGGER_CHANGE` Berechtigung"
					},
					"response": []
				}
			]
		},
		{
			"name": "LogSender - Sources & Content",
			"description": "Log Sender API für den Abruf von Log-Dateien vom Shop.\n\n**Voraussetzungen:**\n- Log Sender Komponente muss aktiviert sein\n- Log-Quellen müssen im Admin aktiviert sein\n\n**Erfordert:** `LOG_SENDER_VIEW` Berechtigung",
			"item": [
				{
					"name": "Get All Enabled Sources",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query LogSenderSources {\n    logSenderSources {\n        id\n        name\n        description\n        origin\n        available\n        paths {\n            path\n            type\n            name\n            description\n            exists\n            readable\n        }\n    }\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt alle aktivierten Log-Quellen zurück.\n\nNur Quellen, die im Admin explizit aktiviert wurden, werden zurückgegeben.\n\n**Erfordert:** `LOG_SENDER_VIEW` Berechtigung"
					},
					"response": []
				},
				{
					"name": "Get Source Content",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query LogSenderContent($sourceId: String!, $maxBytes: Int) {\n    logSenderContent(sourceId: $sourceId, maxBytes: $maxBytes) {\n        sourceId\n        sourceName\n        path\n        content\n        size\n        modified\n        truncated\n    }\n}",
								"variables": "{\n    \"sourceId\": \"oxid_core\",\n    \"maxBytes\": 1048576\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt den Inhalt einer bestimmten Log-Quelle zurück.\n\n**Parameter:**\n- sourceId: Die ID der Log-Quelle (z.B. \"oxid_core\")\n- maxBytes: Optionale maximale Bytes (Standard: Moduleinstellung)\n\n**Erfordert:** `LOG_SENDER_VIEW` Berechtigung"
					},
					"response": []
				}
			]
		}
	]
}
