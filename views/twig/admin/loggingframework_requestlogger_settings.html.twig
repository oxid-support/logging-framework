<!DOCTYPE html>
<html>
<head>
    <title>Request Logger - Settings</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #fff; }
        h1 { margin: 0 0 10px 0; font-size: 18px; color: #333; display: flex; align-items: center; gap: 15px; }
        .component-status { display: inline-flex; align-items: center; gap: 8px; font-size: 12px; padding: 4px 10px; border-radius: 12px; }
        .component-status.active { background: #e8f5e9; color: #2e7d32; }
        .component-status.inactive { background: #f5f5f5; color: #9e9e9e; }
        .toggle-section { margin-bottom: 25px; padding: 15px; background: #f0f7ff; border: 1px solid #2196f3; border-radius: 4px; display: flex; align-items: center; justify-content: space-between; }
        .toggle-section h3 { margin: 0; font-size: 14px; color: #1976d2; }
        .toggle-switch { position: relative; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .3s; border-radius: 26px; }
        .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
        input:checked + .toggle-slider { background-color: #4caf50; }
        input:checked + .toggle-slider:before { transform: translateX(24px); }
        .settings-group { margin-bottom: 25px; padding: 15px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; }
        .settings-group h3 { margin: 0 0 15px 0; color: #333; font-size: 14px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .setting-row { margin-bottom: 15px; display: flex; align-items: center; }
        .setting-row:last-child { margin-bottom: 0; }
        .setting-label { width: 200px; font-weight: bold; color: #555; }
        .setting-input { flex: 1; }
        .setting-input input[type="checkbox"] { width: 18px; height: 18px; }
        .setting-input textarea { width: 100%; max-width: 400px; height: 100px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; font-size: 12px; }
        .setting-help { font-size: 11px; color: #888; margin-top: 5px; }
        .btn-save { background: #4caf50; color: white; border: none; padding: 10px 20px; font-size: 13px; cursor: pointer; border-radius: 4px; transition: all 0.3s ease; }
        .btn-save:hover { background: #45a049; }
        .btn-save.unsaved { background: #ff9800; animation: pulse 1.5s infinite; }
        .btn-save.unsaved:hover { background: #f57c00; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(255, 152, 0, 0); } }
    </style>
</head>
<body>

{% set settings = oView.getSettings() %}
{% set isActive = settings.componentActive %}

<h1>
    {{ translate({ ident: "OXSREQUESTLOGGER_LF_REQUESTLOGGER_TITLE" }) }}
    <span class="component-status {{ isActive ? 'active' : 'inactive' }}">
        {{ isActive ? translate({ ident: "OXSREQUESTLOGGER_LF_STATUS_ACTIVE" }) : translate({ ident: "OXSREQUESTLOGGER_LF_STATUS_INACTIVE" }) }}
    </span>
</h1>
<p style="color: #666; margin-bottom: 20px;">{{ translate({ ident: "OXSREQUESTLOGGER_LF_REQUESTLOGGER_DESC" }) }}</p>

<form method="post" action="{{ oViewConf.getSelfLink()|raw }}" id="toggleForm" target="_self">
    {{ oViewConf.getHiddenSid()|raw }}
    <input type="hidden" name="cl" value="loggingframework_requestlogger_settings">
    <input type="hidden" name="fnc" value="toggleComponent">
    <input type="hidden" name="reloadFrame" value="1">
</form>

<div class="toggle-section">
    <div>
        <h3>{{ translate({ ident: "OXSREQUESTLOGGER_LF_COMPONENT_ACTIVATION" }) }}</h3>
    </div>
    <label class="toggle-switch">
        <input type="checkbox" {{ isActive ? 'checked' : '' }} onchange="submitToggleAndReload();">
        <span class="toggle-slider"></span>
    </label>
</div>

<script>
function submitToggleAndReload() {
    var form = document.getElementById('toggleForm');
    var xhr = new XMLHttpRequest();
    xhr.open('POST', form.action, true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            // Store current controller to expand menu after reload
            if (top.localStorage) {
                top.localStorage.setItem('oxs_lf_expand_nav', 'loggingframework_requestlogger_settings');
            }
            top.location.reload();
        }
    };
    var formData = new FormData(form);
    var params = new URLSearchParams(formData).toString();
    xhr.send(params);
}
</script>

<div>
    <form method="post" action="{{ oViewConf.getSelfLink()|raw }}" id="settingsForm">
        {{ oViewConf.getHiddenSid()|raw }}
        <input type="hidden" name="cl" value="loggingframework_requestlogger_settings">
        <input type="hidden" name="fnc" value="save">

        <div class="settings-group">
            <h3>{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_ACTIVATION" }) }}</h3>

            <div class="setting-row">
                <label class="setting-label">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_LOG_FRONTEND" }) }}</label>
                <div class="setting-input">
                    <input type="checkbox" name="editval[logFrontend]" value="1" {{ settings.logFrontend ? 'checked' : '' }}>
                    <div class="setting-help">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_LOG_FRONTEND_HELP" }) }}</div>
                </div>
            </div>

            <div class="setting-row">
                <label class="setting-label">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_LOG_ADMIN" }) }}</label>
                <div class="setting-input">
                    <input type="checkbox" name="editval[logAdmin]" value="1" {{ settings.logAdmin ? 'checked' : '' }}>
                    <div class="setting-help">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_LOG_ADMIN_HELP" }) }}</div>
                </div>
            </div>
        </div>

        <div class="settings-group">
            <h3>{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_LOGGING" }) }}</h3>

            <div class="setting-row">
                <label class="setting-label">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_DETAILED_LOGGING" }) }}</label>
                <div class="setting-input">
                    <input type="hidden" name="editval[logLevel]" value="standard">
                    <input type="checkbox" name="editval[logLevel]" value="detailed" {{ settings.logLevel == 'detailed' ? 'checked' : '' }}>
                    <div class="setting-help">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_DETAILED_LOGGING_HELP" }) }}</div>
                </div>
            </div>

            <div class="setting-row">
                <label class="setting-label">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_REDACT_ALL" }) }}</label>
                <div class="setting-input">
                    <input type="checkbox" name="editval[redactAllValues]" value="1" {{ settings.redactAllValues ? 'checked' : '' }}>
                    <div class="setting-help">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_REDACT_ALL_HELP" }) }}</div>
                </div>
            </div>
        </div>

        <div class="settings-group">
            <h3>{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_REDACTION" }) }}</h3>

            <div class="setting-row">
                <label class="setting-label">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_REDACT_FIELDS" }) }}</label>
                <div class="setting-input">
                    <textarea name="editval[redactFields]">{{ settings.redactFields|join("\n") }}</textarea>
                    <div class="setting-help">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_REDACT_FIELDS_HELP" }) }}</div>
                </div>
            </div>
        </div>

        <button type="submit" class="btn-save" id="saveBtn">{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_SAVE" }) }}</button>
    </form>
</div>

<script>
(function() {
    var form = document.getElementById('settingsForm');
    var saveBtn = document.getElementById('saveBtn');
    var originalValues = {};
    var unsavedText = '{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_SAVE" }) }} *';
    var savedText = '{{ translate({ ident: "OXSREQUESTLOGGER_LF_SETTINGS_SAVE" }) }}';

    // Store original values on page load
    function storeOriginalValues() {
        var inputs = form.querySelectorAll('input, textarea, select');
        inputs.forEach(function(input) {
            var key = input.name + '_' + input.type;
            if (input.type === 'checkbox') {
                originalValues[key] = input.checked;
            } else if (input.type !== 'hidden') {
                originalValues[key] = input.value;
            }
        });
    }

    // Check if form has changes
    function hasChanges() {
        var inputs = form.querySelectorAll('input, textarea, select');
        for (var i = 0; i < inputs.length; i++) {
            var input = inputs[i];
            var key = input.name + '_' + input.type;
            if (input.type === 'checkbox') {
                if (originalValues[key] !== input.checked) return true;
            } else if (input.type !== 'hidden') {
                if (originalValues[key] !== input.value) return true;
            }
        }
        return false;
    }

    // Update button state
    function updateButtonState() {
        if (hasChanges()) {
            saveBtn.classList.add('unsaved');
            saveBtn.textContent = unsavedText;
        } else {
            saveBtn.classList.remove('unsaved');
            saveBtn.textContent = savedText;
        }
    }

    // Initialize
    storeOriginalValues();

    // Listen for changes
    form.addEventListener('change', updateButtonState);
    form.addEventListener('input', updateButtonState);
})();
</script>

</body>
</html>
